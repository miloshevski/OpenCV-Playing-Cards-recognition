# üÉè –î–µ—Ç–µ–∫—Ü–∏—ò–∞ –∏ —á–∏—Ç–∞—ö–µ –Ω–∞ –∫–∞—Ä—Ç–∏

–û–≤–æ—ò –ø—Ä–æ—Ü–µ—Å —Å–µ —Å–æ—Å—Ç–æ–∏ –æ–¥ **5 —á–µ–∫–æ—Ä–∏**:

---

## 1Ô∏è‚É£ –î–µ—Ç–µ–∫—Ç–∏—Ä–∞—ö–µ –Ω–∞ –∫–∞—Ä—Ç–∏

```bash
python cards_otsu_detect.py test.jpg --warp-dir out_cards --mask-out mask.png --panel-out panel.jpg
```

‚û§ –ì–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ä–∞ —Å–∏—Ç–µ –∫–∞—Ä—Ç–∏ –Ω–∞ —Å–ª–∏–∫–∞, –≥–∏ –∑–∞–ø–∏—à—É–≤–∞ –∫–∞–∫–æ –ø–æ–µ–¥–∏–Ω–µ—á–Ω–∏ —Å–ª–∏–∫–∏ –≤–æ `out_cards/`  
‚û§ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª–Ω–æ, –≥–µ–Ω–µ—Ä–∏—Ä–∞ –º–∞—Å–∫–∞ –∏ –ø—Ä–µ–≥–ª–µ–¥–µ–Ω –ø–∞–Ω–µ–ª

---

## 2Ô∏è‚É£ –ß–∏—Ç–∞—ö–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å (—Ä–∞–Ω–≥ + –±–æ—ò–∞)

```bash
python read_indices_from_out_cards_v2.py   --roi_w 0.18   --roi_h 0.312   --split_y 0.568   --left_band 0.48   --max_rel_area 0.15   --min_area 19   --debug
```

‚û§ –ì–∏ —á–∏—Ç–∞ –∏—Å–µ—á–µ–Ω–∏—Ç–µ –∫–∞—Ä—Ç–∏ –æ–¥ `out_cards/`  
‚û§ –ê–≤—Ç–æ–º–∞—Ç—Å–∫–∏ –¥–µ—Ç–µ–∫—Ç–∏—Ä–∞ `rank` –∏ `suit`  
‚û§ –ó–∞–ø–∏—à—É–≤–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ –≤–æ `out_cards_indices.json`  
‚û§ –ì–µ–Ω–µ—Ä–∏—Ä–∞ –¥–µ–±–∞–≥ —Å–ª–∏–∫–∏ –≤–æ `_debug_indices/`

---

## 3Ô∏è‚É£ –ò—Å–µ–∫—É–≤–∞—ö–µ –Ω–∞ binarized `rank` –∏ `suit` —Ä–µ–≥–∏–æ–Ω–∏

```bash
python extract_crops_and_predict.py
```

‚û§ –ì–∏ –≤–∞–¥–∏ binarized –¥–µ–ª–æ–≤–∏—Ç–µ –∑–∞ `rank` –∏ `suit`  
‚û§ –ì–∏ –∑–∞—á—É–≤—É–≤–∞ –≤–æ `crops/`  
‚û§ –ü—Ä–∏–∫–∞–∂—É–≤–∞ –ø—Ä–µ–¥–∏–∫—Ü–∏—ò–∞ –∑–∞ —Å–µ–∫–æ—ò–∞ –∫–∞—Ä—Ç–∞

---

## 4Ô∏è‚É£ –°–µ—á–µ—ö–µ –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–∞—ö–µ –Ω–∞ `crops`

```bash
python seci.py
```

‚û§ –ì–∏ –æ–±—Ä–∞–±–æ—Ç—É–≤–∞ `crops/` –∏ –≥–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞ –∑–∞ –Ω–∞—Ç–∞–º–æ—à–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞

---

## 5Ô∏è‚É£ –§–∏–Ω–∞–ª–Ω–æ –ø—Ä–µ–ø–æ–∑–Ω–∞–≤–∞—ö–µ

```bash
python match_all.py
```

‚û§ –ì–∏ —á–∏—Ç–∞ `crops` –∏ —Å–ø–æ—Ä–µ–¥—É–≤–∞ —Å–æ —Ç–µ–º–ø–ª–µ—ò—Ç–∏ –æ–¥ `templates/ranks` –∏ `templates/suits`  
‚û§ –ì–æ —Å–æ–∑–¥–∞–≤–∞ `final_cards.json` —Å–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä–∞–Ω–∏ –∫–∞—Ä—Ç–∏

---

## ‚úÖ –¶–µ–ª–æ—Å–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–æ

```bash
python main.py test.jpg
```

‚û§ –ì–∏ –∏–∑–≤—Ä—à—É–≤–∞ —Å–∏—Ç–µ —á–µ–∫–æ—Ä–∏ –ø–æ–≥–æ—Ä–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ  
‚û§ –ù–∞ –∫—Ä–∞—ò –≤—Ä–∞—ú–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç: `["7c", "As", "10d"]`

---

## üöÄ FastAPI endpoint

```bash
uvicorn api:app --reload
```

‚û§ –î–æ—Å—Ç–∞–ø–Ω–æ –Ω–∞ `http://127.0.0.1:8000/predict`  
‚û§ –ü–æ–¥–¥—Ä–∂—É–≤–∞ `POST` —Å–ª–∏–∫–∞, –≤—Ä–∞—ú–∞ JSON —Å–æ –∫–∞—Ä—Ç–∏

---

## üìå –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∑–∞ –ø—Ä–∏–ª–∞–≥–æ–¥—É–≤–∞—ö–µ –∏ –∫–æ—Ä–∏—Å—Ç–µ—ö–µ

–ó–∞ –¥–∞ –º–æ–∂–µ—Ç–µ —É—Å–ø–µ—à–Ω–æ –¥–∞ —ò–∞ –ø—Ä–∏–ª–∞–≥–æ–¥–∏—Ç–µ –æ–≤–∞–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞ –≤–∞—à–∏—Ç–µ –ø–æ—Ç—Ä–µ–±–∏, –ø–æ—Ç—Ä–µ–±–Ω–æ –µ –¥–∞ –∫–æ—Ä–∏—Å—Ç–∏—Ç–µ **—Å–ª–∏–∫–∏ –æ–¥ –≤–∞—à–∏—Ç–µ —Å–æ–ø—Å—Ç–≤–µ–Ω–∏ –∫–∞—Ä—Ç–∏** –∑–∞ –ø–æ–ø—Ä–µ—Ü–∏–∑–Ω–æ –ø—Ä–µ–ø–æ–∑–Ω–∞–≤–∞—ö–µ.

- –í–æ `templates/ranks/` —Å—Ç–∞–≤–µ—Ç–µ –∏—Å–µ—á–µ–Ω–∏ —Å–ª–∏–∫–∏ –æ–¥ –±—Ä–æ—ò–∫–∏—Ç–µ –Ω–∞ —Å–∏—Ç–µ –∫–∞—Ä—Ç–∏ (–æ–¥ A –¥–æ K), **–±–∏–Ω–∞—Ä–∏–∑–∏—Ä–∞–Ω–∏** –∏ –≤–æ **—Ä–µ–∑–æ–ª—É—Ü–∏—ò–∞ 70x120** –ø–∏–∫—Å–µ–ª–∏.
- –í–æ `templates/suits/` —Å—Ç–∞–≤–µ—Ç–µ –≥–∏ —Å–∏–º–±–æ–ª–∏—Ç–µ (—Å—Ä—Ü–µ, –¥–µ—Ç–µ–ª–∏–Ω–∞, –ª–∏—Å—Ç, –∫–ª–æ–ø—á–µ) **–±–∏–Ω–∞—Ä–∏–∑–∏—Ä–∞–Ω–∏** –≤–æ **70x70** –ø–∏–∫—Å–µ–ª–∏.

üîπ –û—Ç–∫–∞–∫–æ —ú–µ –≥–∏ –≤–Ω–µ—Å–µ—Ç–µ –≤–∞—à–∏—Ç–µ —Å–ª–∏–∫–∏, —Å—Ç–∞—Ä—Ç—É–≤–∞—ò—Ç–µ –µ–¥–Ω–∞—à:

```bash
python seci.py
```

üîπ –ü–æ—Ç–æ–∞, —Å–ª–∏–∫–∞—ò—Ç–µ –≤–∞—à–∏ –∫–∞—Ä—Ç–∏ –Ω–∞ **—Ü—Ä–Ω–∞ –ø–æ–∑–∞–¥–∏–Ω–∞** –∏ –∑–∞—á—É–≤–∞—ò—Ç–µ —ò–∞ —Å–ª–∏–∫–∞—Ç–∞ (–Ω–∞ –ø—Ä–∏–º–µ—Ä `test.jpg`). –ò–∑–≤—Ä—à–µ—Ç–µ:

```bash
python cards_otsu_detect.py test.jpg --warp-dir out_cards --mask-out mask.png --panel-out panel.jpg
```

üîπ –å–µ –¥–æ–±–∏–µ—Ç–µ `out_cards/` —Å–æ –∏—Å–µ—á–µ–Ω–∏ –∫–∞—Ä—Ç–∏ –æ–¥ —Å–ª–∏–∫–∞—Ç–∞. –ó–∞ –∫–∞–ª–∏–±—Ä–∞—Ü–∏—ò–∞ –∏–∑–≤—Ä—à–µ—Ç–µ:

```bash
python measure_index_coords.py
```

–í–æ –ø—Ä–æ–∑–æ—Ä–µ—Ü–æ—Ç —à—Ç–æ —ú–µ —Å–µ –æ—Ç–≤–æ—Ä–∏:

1. –û–±–µ–ª–µ–∂–µ—Ç–µ –ø—Ä–∞–≤–æ–∞–≥–æ–ª–Ω–∏–∫ –æ–∫–æ–ª—É –±—Ä–æ—ò–∫–∞—Ç–∞ (Enter)
2. –û–±–µ–ª–µ–∂–µ—Ç–µ –ø—Ä–∞–≤–æ–∞–≥–æ–ª–Ω–∏–∫ –æ–∫–æ–ª—É —Å–∏–º–±–æ–ª–æ—Ç (Enter)
3. –ü—Ä–∏—Ç–∏—Å–Ω–µ—Ç–µ Esc

–í–æ `_measure/card_01_measure.json` —ú–µ —Å–µ –ø–æ—ò–∞–≤–∏ `suggested_params`. –ö–æ—Ä–∏—Å—Ç–µ—Ç–µ –≥–∏ —Ç–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—Ä–∏:

```bash
python read_indices_from_out_cards_v2.py --roi_w ... --roi_h ... –∏—Ç–Ω.
```

üîπ –ü–æ—Ç–æ–∞:

```bash
python extract_crops_and_predict.py
python match_all.py
```

üîπ –ò–ª–∏ –∞–≤—Ç–æ–º–∞—Ç—Å–∫–∏:

```bash
python main.py test.jpg
```

---

## üåê FastAPI

–ó–∞ —Å—Ç–∞—Ä—Ç—É–≤–∞—ö–µ –Ω–∞ API —Å–µ—Ä–≤–µ—Ä–æ—Ç:

```bash
uvicorn api:app --reload
```

‚û§ –ü–æ—Ç–æ–∞ –º–æ–∂–µ—Ç–µ –¥–∞ –∏—Å–ø—Ä–∞—ú–∞—Ç–µ —Å–ª–∏–∫–∏ –ø—Ä–µ–∫—É `POST /predict` –∏ —ú–µ –¥–æ–±–∏–µ—Ç–µ JSON —Å–æ —Å–∏—Ç–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä–∞–Ω–∏ –∫–∞—Ä—Ç–∏.
